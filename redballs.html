<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bouncing Balls with Gravitational Attraction</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
        }
        #canvas {
            border: 1px solid black;
            display: block;
        }
        #topControls {
            position: fixed;
            top: 20px;
            display: flex;
            justify-content: center;
            width: 100%;
        }
        .controlButton {
            padding: 10px 20px;
            font-size: 16px;
            margin: 0 10px;
            cursor: pointer;
        }
        #sliderContainer {
            position: fixed;
            bottom: 20px;
            width: 100%;
            text-align: center;
        }
        #speedSlider {
            width: 300px;
        }
        #sizeSliderContainer {
            position: fixed;
            right: 20px;
            height: 60%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #sizeSlider {
            height: 300px;
            writing-mode: bt-lr; /* vertical slider */
            transform: rotate(270deg);
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="topControls">
        <button class="controlButton" id="addBall">+</button>
        <button class="controlButton" id="removeBall">-</button>
    </div>
    <div id="sliderContainer">
        <input type="range" id="speedSlider" min="1" max="10" value="5">
    </div>
    <div id="sizeSliderContainer">
        <input type="range" id="sizeSlider" min="10" max="100" value="20">
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const speedSlider = document.getElementById('speedSlider');
        const sizeSlider = document.getElementById('sizeSlider');
        const addBallButton = document.getElementById('addBall');
        const removeBallButton = document.getElementById('removeBall');

        let width = window.innerWidth;
        let height = window.innerHeight - 60; // Adjust for controls
        canvas.width = width;
        canvas.height = height;

        let balls = [
            {
                x: width / 2,
                y: height / 2,
                radius: 20,
                dx: 2,
                dy: 2,
                color: 'red'
            },
            {
                x: width / 3,
                y: height / 3,
                radius: 20,
                dx: -2,
                dy: -2,
                color: 'red'
            }
        ];

        let speed = 5;

        speedSlider.addEventListener('input', (e) => {
            speed = e.target.value;
        });

        sizeSlider.addEventListener('input', (e) => {
            const newSize = e.target.value;
            balls.forEach(ball => ball.radius = parseInt(newSize));
        });

        addBallButton.addEventListener('click', () => {
            let dx = (Math.random() * 4 - 2) || 1; // Ensure dx is not zero
            let dy = (Math.random() * 4 - 2) || 1; // Ensure dy is not zero

            balls.push({
                x: Math.random() * width,
                y: Math.random() * height,
                radius: parseInt(sizeSlider.value),
                dx: dx,
                dy: dy,
                color: 'red'
            });
        });

        removeBallButton.addEventListener('click', () => {
            if (balls.length > 1) {
                balls.pop();
            }
        });

        function drawBall(ball) {
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fillStyle = ball.color;
            ctx.fill();
            ctx.closePath();
        }

        function updateBall(ball) {
            ball.x += ball.dx * speed;
            ball.y += ball.dy * speed;

            // Bounce off walls
            if (ball.x + ball.radius > width || ball.x - ball.radius < 0) {
                ball.dx *= -1;
            }

            if (ball.y + ball.radius > height || ball.y - ball.radius < 0) {
                ball.dy *= -1;
            }
        }

        function detectCollisions() {
            for (let i = 0; i < balls.length; i++) {
                for (let j = i + 1; j < balls.length; j++) {
                    const dx = balls[j].x - balls[i].x;
                    const dy = balls[j].y - balls[i].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const minDistance = balls[i].radius + balls[j].radius;

                    if (distance < minDistance) {
                        // Calculate the angle of the collision
                        const angle = Math.atan2(dy, dx);

                        // Calculate new velocities based on the collision
                        const u1 = rotate({ x: balls[i].dx, y: balls[i].dy }, angle);
                        const u2 = rotate({ x: balls[j].dx, y: balls[j].dy }, angle);

                        // Swap velocities for elastic collision
                        const v1 = { x: u2.x, y: u1.y };
                        const v2 = { x: u1.x, y: u2.y };

                        // Rotate velocities back
                        const finalV1 = rotate(v1, -angle);
                        const finalV2 = rotate(v2, -angle);

                        // Apply new velocities
                        balls[i].dx = finalV1.x;
                        balls[i].dy = finalV1.y;
                        balls[j].dx = finalV2.x;
                        balls[j].dy = finalV2.y;

                        // Move balls apart to avoid overlap
                        const overlap = (minDistance - distance) / 2;
                        balls[i].x -= Math.cos(angle) * overlap;
                        balls[i].y -= Math.sin(angle) * overlap;
                        balls[j].x += Math.cos(angle) * overlap;
                        balls[j].y += Math.sin(angle) * overlap;

                        // Ensure balls are not pushed outside the canvas bounds
                        if (balls[i].x - balls[i].radius < 0) balls[i].x = balls[i].radius;
                        if (balls[i].x + balls[i].radius > width) balls[i].x = width - balls[i].radius;
                        if (balls[i].y - balls[i].radius < 0) balls[i].y = balls[i].radius;
                        if (balls[i].y + balls[i].radius > height) balls[i].y = height - balls[i].radius;

                        if (balls[j].x - balls[j].radius < 0) balls[j].x = balls[j].radius;
                        if (balls[j].x + balls[j].radius > width) balls[j].x = width - balls[j].radius;
                        if (balls[j].y - balls[j].radius < 0) balls[j].y = balls[j].radius;
                        if (balls[j].y + balls[j].radius > height) balls[j].y = height - balls[j].radius;
                    }
                }
            }
        }

        function applyGravity() {
            const G = 1; // Further increased gravitational constant

            for (let i = 0; i < balls.length; i++) {
                for (let j = i + 1; j < balls.length; j++) {
                    const dx = balls[j].x - balls[i].x;
                    const dy = balls[j].y - balls[i].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance > 0) {
                        const force = G * (balls[i].radius * balls[j].radius) / (distance * distance);
                        const ax = force * dx / distance;
                        const ay = force * dy / distance;

                        balls[i].dx += ax;
                        balls[i].dy += ay;
                        balls[j].dx -= ax;
                        balls[j].dy -= ay;
                    }
                }
            }
        }

        function rotate(velocity, angle) {
            return {
                x: velocity.x * Math.cos(angle) - velocity.y * Math.sin(angle),
                y: velocity.x * Math.sin(angle) + velocity.y * Math.cos(angle)
            };
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, width, height);
        }

        function animate() {
            clearCanvas();
            balls.forEach(ball => {
                drawBall(ball);
                updateBall(ball);
            });
            detectCollisions();
            applyGravity();
            requestAnimationFrame(animate);
        }

        animate();

        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight - 60; // Adjust for controls
            canvas.width = width;
            canvas.height = height;
        });
    </script>
</body>
</html>
